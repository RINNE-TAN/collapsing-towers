import CollapsingTowers.TwoLevelRec.LogicEquiv.LogicRelation

-- Î“ âŠ§ x â‰¤ğ‘™ğ‘œğ‘” x : Î“(x)
lemma compatibility.fvar :
  âˆ€ Î“ x Ï„,
    binds x (Ï„, ğŸ™) Î“ â†’
    wbt ğŸ™ Ï„ â†’
    logic_rel_typing Î“ (.fvar x) (.fvar x) Ï„ :=
  by
  intros Î“ x Ï„ Hbinds Hwbt
  constructor; apply typing.fvar; apply Hbinds; apply Hwbt
  constructor; apply typing.fvar; apply Hbinds; apply Hwbt
  intros k Î³â‚€ Î³â‚ HsemÎ“
  simp only [logic_rel_expr]
  intros z Hindexz vâ‚€ Hvalueâ‚€ Hstepâ‚€
  exists multi_subst Î³â‚ (.fvar x)
  constructor
  . apply pure_stepn.refl
  . have Hsem_value := logic_rel_env.binds_logic_rel_value _ _ _ _ _ _ HsemÎ“ Hbinds
    have âŸ¨Hvalueâ‚€, Hvalueâ‚âŸ© := logic_rel_value.syntactic.value _ _ _ _ Hsem_value
    have âŸ¨HEqv, HzâŸ© := pure_stepn_indexed.value_impl_termination _ _ _ Hvalueâ‚€ Hstepâ‚€
    rw [â† HEqv, Hz]; apply Hsem_value

-- Î“ âŠ§ n â‰¤ğ‘™ğ‘œğ‘” n : â„•
lemma compatibility.lit :
  âˆ€ Î“ n, logic_rel_typing Î“ (.lit n) (.lit n) .nat :=
  by
  intros _ n
  constructor; apply typing.lit
  constructor; apply typing.lit
  intros k Î³â‚€ Î³â‚ semÎ“
  simp only [logic_rel_expr]
  intros z Hindexz vâ‚€ Hvalueâ‚€ Hstepâ‚€
  exists .lit n
  constructor
  . simp; apply pure_stepn.refl
  . simp at Hstepâ‚€
    have âŸ¨HEqv, HzâŸ© := pure_stepn_indexed.value_impl_termination _ _ _ (value.lit n) Hstepâ‚€
    simp [â† HEqv, Hz]

-- x â†¦ Ï„ğ•’, Î“ âŠ§ eâ‚€ â‰¤ğ‘™ğ‘œğ‘” eâ‚ : Ï„ğ•“
-- â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
-- Î“ âŠ§ Î»x.eâ‚€ â‰¤ğ‘™ğ‘œğ‘” Î»x.eâ‚ : Ï„ğ•’ â†’ Ï„ğ•“
lemma compatibility.lam :
  âˆ€ Î“ eâ‚€ eâ‚ Ï„ğ•’ Ï„ğ•“,
    wbt ğŸ™ Ï„ğ•’ â†’
    closed_at eâ‚€ Î“.length â†’
    closed_at eâ‚ Î“.length â†’
    logic_rel_typing ((Ï„ğ•’, ğŸ™) :: Î“) ({0 â†¦ Î“.length} eâ‚€) ({0 â†¦ Î“.length} eâ‚) Ï„ğ•“ â†’
    logic_rel_typing Î“ (.lam eâ‚€) (.lam eâ‚) (.arrow Ï„ğ•’ Ï„ğ•“ âˆ…) :=
  by
  intros Î“ eâ‚€ eâ‚ Ï„ğ•’ Ï„ğ•“ Hwbt Hclosedâ‚€ Hclosedâ‚ He
  have âŸ¨HÏ„â‚€, HÏ„â‚, HeâŸ© := He
  have HÏ„â‚€ : typing Î“ ğŸ™ (.lam eâ‚€) (.arrow Ï„ğ•’ Ï„ğ•“ âˆ…) âˆ… := by apply typing.lam; apply HÏ„â‚€; apply Hwbt; apply Hclosedâ‚€
  have HÏ„â‚ : typing Î“ ğŸ™ (.lam eâ‚) (.arrow Ï„ğ•’ Ï„ğ•“ âˆ…) âˆ… := by apply typing.lam; apply HÏ„â‚; apply Hwbt; apply Hclosedâ‚
  constructor; apply HÏ„â‚€
  constructor; apply HÏ„â‚
  all_goals admit
